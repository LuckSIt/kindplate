#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è frontend –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

echo "üîÑ –ù–∞—á–∏–Ω–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ frontend..."

# 1. –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–¥ –∏–∑ Git
echo "üì• –ü–æ–ª—É—á–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ Git..."
git pull origin main || git pull amvera main

# 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ–∞–π–ª –æ–±–Ω–æ–≤–∏–ª—Å—è
if grep -q "–í—ã–≥–æ–¥–Ω–æ –¥–ª—è —Ç–µ–±—è" frontend/src/routes/index.tsx; then
    echo "‚úÖ –ö–æ–¥ –æ–±–Ω–æ–≤–∏–ª—Å—è —É—Å–ø–µ—à–Ω–æ"
else
    echo "‚ùå –ö–æ–¥ –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ git pull"
    exit 1
fi

# 3. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã..."
docker compose down frontend

# 4. –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏)
echo "üßπ –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã..."
docker rmi $(docker images | grep kindplate-frontend | awk '{print $3}') 2>/dev/null || true

# 5. –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º –ë–ï–ó –∫–µ—à–∞
echo "üî® –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º frontend –±–µ–∑ –∫–µ—à–∞..."
docker compose build --no-cache frontend

# 6. –ó–∞–ø—É—Å–∫–∞–µ–º
echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º frontend..."
docker compose up -d frontend

# 7. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏
echo "üìã –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å—Ç—Ä–æ–∫)..."
docker compose logs --tail=20 frontend

echo ""
echo "‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
echo "üí° –ù–µ –∑–∞–±—É–¥—å—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞ –∏–ª–∏ –æ—Ç–∫—Ä—ã—Ç—å –≤ —Ä–µ–∂–∏–º–µ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ"

