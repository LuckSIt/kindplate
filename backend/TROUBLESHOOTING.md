# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å –±—ç–∫–µ–Ω–¥–æ–º (502 Bad Gateway)

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ** - —Å–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è, –µ—Å–ª–∏ –ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
2. **–£–ª—É—á—à–µ–Ω–Ω—ã–π health check** - —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –¥–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ graceful shutdown
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫

## –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –±—ç–∫–µ–Ω–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –±—ç–∫–µ–Ω–¥–∞

```bash
docker-compose logs backend
```

–ò—â–∏—Ç–µ:
- ‚úÖ `üöÄ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 5000`
- ‚úÖ `‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ`
- ‚ùå –û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
- ‚ùå –û—à–∏–±–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ health endpoint

```bash
curl https://api-kindplate.ru/health
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å:
```json
{
  "status": "ok",
  "database": "connected",
  "timestamp": "..."
}
```

–ï—Å–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 503, –∑–Ω–∞—á–∏—Ç –ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `docker-compose.yml` –∏–ª–∏ `.env` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:
- `PORT=5000`
- `DB_HOST=postgres` (–∏–ª–∏ –≤–∞—à —Ö–æ—Å—Ç –ë–î)
- `DB_NAME=kindplate`
- `DB_USER=kind`
- `DB_PASSWORD=plate`
- `DB_PORT=5432`
- `SECRET_KEY` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã

```bash
docker-compose ps
```

–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Å—Ç–∞—Ç—É—Å–µ `Up`.

### 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –±—ç–∫–µ–Ω–¥–∞

```bash
docker-compose exec backend sh
# –í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
psql -h postgres -U kind -d kindplate
```

–ï—Å–ª–∏ –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –ó–∞–ø—É—â–µ–Ω –ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `postgres`
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ª–∏ credentials –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Caddy

```bash
docker-compose logs caddy
```

–ò—â–∏—Ç–µ –æ—à–∏–±–∫–∏ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è –∫ `backend:5000`.

## –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `postgres` –∑–∞–ø—É—â–µ–Ω –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ.

### –ü—Ä–æ–±–ª–µ–º–∞: PORT –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
**–†–µ—à–µ–Ω–∏–µ**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `docker-compose.yml` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `PORT: 5000`.

### –ü—Ä–æ–±–ª–µ–º–∞: –°–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `SECRET_KEY`
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î
- –ü–æ—Ä—Ç —É–∂–µ –∑–∞–Ω—è—Ç

### –ü—Ä–æ–±–ª–µ–º–∞: Caddy –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 502
**–†–µ—à–µ–Ω–∏–µ**: 
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±—ç–∫–µ–Ω–¥ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ `/health`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Caddy
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `Caddyfile` –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–∫–∞–∑–∞–Ω `backend:5000`

## –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –±—ç–∫–µ–Ω–¥
docker-compose restart backend

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose restart

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose up -d --build backend
```

## –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

```bash
# –õ–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞
docker-compose logs -f backend

# –õ–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose logs -f
```

