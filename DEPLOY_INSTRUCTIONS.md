# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –Ω–∞ TimeWeb VPS

## –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **DNS –Ω–∞—Å—Ç—Ä–æ–π–∫–∞** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!):
   - A-–∑–∞–ø–∏—Å—å: `app-kindplate.tw1.ru` ‚Üí `45.132.50.45`
   - A-–∑–∞–ø–∏—Å—å: `api-kindplate.tw1.ru` ‚Üí `45.132.50.45`
   - –ü–æ–¥–æ–∂–¥–∏—Ç–µ 5-10 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–µ–π –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è DNS

2. **–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã**:
   - Docker
   - Docker Compose
   - Git

## –®–∞–≥–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### 1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ SSH
```bash
ssh root@45.132.50.45
```

### 2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
```bash
cd /root/kindplate
```

### 3. –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```bash
git pull origin main
```

### 4. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env (–µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç)
```bash
cat > .env << 'EOF'
DATABASE_URL=postgresql://kind:plate@postgres:5432/kindplate
SECRET_KEY=$(openssl rand -base64 32)
FRONTEND_ORIGIN=https://app-kindplate.tw1.ru
VITE_BACKEND_BASE_URL=https://api-kindplate.tw1.ru
VITE_VAPID_PUBLIC_KEY=
EOF
```

### 5. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
```bash
docker compose down
```

### 6. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑—ã —Å —á–∏—Å—Ç—ã–º –∫–µ—à–µ–º
```bash
docker compose build --no-cache
```

### 7. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
```bash
docker compose up -d
```

### 8. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
```bash
docker compose ps
docker compose logs -f --tail=100
```

–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Å—Ç–∞—Ç—É—Å–µ "Up". –ù–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –≤—ã—Ö–æ–¥–∞ –∏–∑ –ª–æ–≥–æ–≤.

### 9. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É

**–ß–µ—Ä–µ–∑ 2-3 –º–∏–Ω—É—Ç—ã** (–≤—Ä–µ–º—è –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –æ—Ç Let's Encrypt):

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–ò–Ω–∫–æ–≥–Ω–∏—Ç–æ):
   - https://app-kindplate.tw1.ru

2. –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12 ‚Üí Network) –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - –ó–∞–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –∏–¥—Ç–∏ –Ω–∞ `https://api-kindplate.tw1.ru/...`
   - –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å–ø–µ—à–Ω—ã–º–∏ (—Å—Ç–∞—Ç—É—Å 200)
   - –ù–µ—Ç –æ—à–∏–±–æ–∫ `ERR_NAME_NOT_RESOLVED` –∏–ª–∏ `ERR_TUNNEL_CONNECTION_FAILED`

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã:
   - –í –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ –±—Ä–∞—É–∑–µ—Ä–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–º–æ–∫ üîí
   - –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –≤—ã–¥–∞–Ω—ã Let's Encrypt

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ —Å–æ–±—Ä–∞–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º API URL:
```bash
docker compose exec frontend sh -c "grep -r 'api-kindplate.tw1.ru' /usr/share/nginx/html | head -n 5"
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å `api-kindplate.tw1.ru`.

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Caddy –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ SSL:
```bash
docker compose logs caddy -f
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ backend –æ—Ç–≤–µ—á–∞–µ—Ç:
```bash
curl -v http://localhost:5000/health 2>&1 | grep -E '(HTTP|health)'
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ DNS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ:
```bash
nslookup app-kindplate.tw1.ru
nslookup api-kindplate.tw1.ru
```

–û–±–∞ –¥–æ–º–µ–Ω–∞ –¥–æ–ª–∂–Ω—ã —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ `45.132.50.45`.

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ï—Å–ª–∏ —Å–∞–π—Ç –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è:

1. **DNS –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω**:
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ A-–∑–∞–ø–∏—Å–∏ –≤ –ø–∞–Ω–µ–ª–∏ TimeWeb
   - –ü–æ–¥–æ–∂–¥–∏—Ç–µ 5-10 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–µ—Ä–µ–∑ `nslookup` –∏–ª–∏ https://dnschecker.org

2. **Caddy –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç**:
   ```bash
   docker compose logs caddy | grep -i error
   ```
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç—ã 80 –∏ 443 –æ—Ç–∫—Ä—ã—Ç—ã
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall: `ufw status`
   - –ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –æ—Ç–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç—ã:
     ```bash
     ufw allow 80/tcp
     ufw allow 443/tcp
     ```

3. **Frontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é**:
   - –û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+Shift+Del)
   - –û—Ç–∫—Ä–æ–π—Ç–µ –≤ —Ä–µ–∂–∏–º–µ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ
   - –î–æ–±–∞–≤—å—Ç–µ `?nocache=$(date +%s)` –∫ URL

4. **Backend –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç**:
   ```bash
   docker compose logs backend -f
   docker compose exec backend sh -c 'curl -v http://localhost:5000/health'
   ```

5. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è**:
   ```bash
   docker compose logs postgres -f
   docker compose exec postgres psql -U kind -d kindplate -c '\dt'
   ```

## –ë—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:

```bash
cd /root/kindplate
git pull origin main
docker compose down
docker compose up -d --build
```

## –û—á–∏—Å—Ç–∫–∞ –∏ –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞

‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ**: –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã!

```bash
cd /root/kindplate
docker compose down -v
docker system prune -af --volumes
git pull origin main
docker compose up -d --build
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –ª–æ–≥–æ–≤:
```bash
docker compose logs -f
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞:
```bash
docker compose logs -f frontend
docker compose logs -f backend
docker compose logs -f caddy
docker compose logs -f postgres
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤:
```bash
docker stats
```

### –†–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–æ–≤ –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:
```bash
docker system df
```

